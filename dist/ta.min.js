/*!
 * ta.js 0.0.1
 * http://github.com/andidev/ta.js
 * Copyright (c) 2014 Anders Steiner; Licensed Apache-2.0
 */

"use strict";!function(){var a=Object.prototype.toString,b=Array.isArray||function(b){return"[object Array]"===a.call(b)},c=function(a){if(!(this instanceof c))return new c(a);if(b(a))this.array=a;else{if(a instanceof c)return c(a.asArray());this.array=[]}return this};c.fn=c.prototype={asArray:function(){return this.array},max:function(){return Math.max.apply(Math,this.array)},min:function(){return Math.min.apply(Math,this.array)},sum:function(a,b){void 0===a&&void 0===b&&(a=0,b=this.array.length);for(var c=0,d=a;b>d;d++){if(null===this.array[d])throw"Cannot sum array from index "+a+" to "+b+" since value is null at index "+d+", array = "+this.array;c+=this.array[d]}return c},plus:function(a){a instanceof c&&(a=a.asArray());for(var b=[],d=0;d<this.array.length;d++)b[d]=null!==this.array[d]&&null!==a[d]?this.array[d]+a[d]:null;return c(b)},minus:function(a){a instanceof c&&(a=a.asArray());for(var b=[],d=0;d<this.array.length;d++)b[d]=null!==this.array[d]&&null!==a[d]?this.array[d]-a[d]:null;return c(b)},a:function(a,b){void 0===a&&void 0===b&&(a=0,b=this.array.length);for(var c=0,d=a;b>d;d++){if(null===this.array[d])throw"Cannot calculate array avarage from index "+a+" to "+b+" since value is null at index "+d+", array = "+this.array;c+=this.array[d]}return c/(b-a)}},c.fn.sma=function(a,b,d){void 0===b&&void 0===d&&(b=0,d=this.array.length);for(var e=[],f=0,g=b;d>g;g++)a-1+f>g?(e[g-b]=null,null===this.array[g]&&f++):e[g-b]=null===e[g-b-1]||0>g-b-1?this.sum(g-(a-1),g+1)/a:e[g-b-1]+(this.array[g]-this.array[g-a])/a;return c(e)},c.fn.ema=function(a,b,d){void 0===b&&void 0===d&&(b=0,d=this.array.length);for(var e=2/(a+1),f=[],g=0,h=b;d>h;h++)a-1+g>h?(f[h-b]=null,null===this.array[h]&&g++):f[h-b]=null===f[h-b-1]||0>h-b-1?this.sma(a,h,h+1).asArray()[0]:(this.array[h]-f[h-b-1])*e+f[h-b-1];return c(f)},c.fn.rsi=function(a,b,d,e){void 0===d&&void 0===e&&(d=0,e=this.array.length);var f,g,h,i;if(b===!0){for(f=[null],g=[null],h=[null],i=d+1;e>i;i++)this.array[i]>this.array[i-1]?(f[i-d]=this.array[i]-this.array[i-1],g[i-d]=0):(f[i-d]=0,g[i-d]=this.array[i-1]-this.array[i]);var j=c(f.slice(1,f.length)).ema(a).asArray(),k=c(g.slice(1,g.length)).ema(a).asArray();for(j.unshift(null),k.unshift(null),i=d+1;e>i;i++)h[i-d]=null===j||null===k[i]?null:0===k[i]?100:100-100/(1+j[i]/k[i]);return c(h)}for(f=0,g=0,h=[],i=d;e>i;i++)i===d?h[i-d]=null:a>=i?(h[i-d]=null,this.array[i-1]<=this.array[i]?f=f+this.array[i]-this.array[i-1]:g=g+this.array[i-1]-this.array[i],i===a&&(h[i-d]=100-100/(1+f/g))):(this.array[i-1]<=this.array[i]?(f=f/a*(a-1)+this.array[i]-this.array[i-1],g=g/a*(a-1)):(f=f/a*(a-1),g=g/a*(a-1)+this.array[i-1]-this.array[i]),h[i-d]=100-100/(1+f/g));return c(h)},c.fn.macd=function(a,b,c,d,e){void 0===a&&(a=12),void 0===b&&(b=26),void 0===c&&(c=9),void 0===d&&void 0===e&&(d=0,e=this.array.length);var f=this.ema(a,d,e).minus(this.ema(b,d,e)),g=f.ema(c,d,e),h=f.minus(g);return{macd:f,signal:g,divergence:h}},window.TA=c}();